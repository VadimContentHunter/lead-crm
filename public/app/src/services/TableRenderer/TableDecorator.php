<?php

namespace crm\src\services\TableRenderer;

/**
 * –î–æ–±–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–µ–π—Å—Ç–≤–∏—è).
 */
class TableDecorator
{
    /**
     * –î–æ–±–∞–≤–ª—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É –∫–æ–ª–æ–Ω–∫—É —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏.
     *
     * @param  string[] $header
     * @param  array<array<mixed>> $rows
     * @param  string $actionLabel
     * @return array{header: string[], rows: array<array<mixed>>}
     */
    public function decorateWithActions(array $header, array $rows, string $hrefButton = '', string $hrefButtonDel = '', string $actionLabel = ''): array
    {
        $newHeader = [...$header, $actionLabel];
        $newRows = [];

        foreach ($rows as $row) {
            $id = $this->extractId($row);
            $buttons = $this->buildActions($id, $hrefButton, $hrefButtonDel);

            $newRows[] = [...$row, $buttons];
        }

        return [
            'header' => $newHeader,
            'rows' => $newRows
        ];
    }

    /**
     * –ò–∑–≤–ª–µ–∫–∞–µ—Ç ID –∏–∑ –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏.
     *
     * @param array<int,mixed> $row
     */
    protected function extractId(array $row): mixed
    {
        return $row[0]['value'] ?? $row[0] ?? null;
    }

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML-–∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏.
     */
    protected function buildActions(mixed $id, string $href = '', string $hrefDel = ''): string
    {
        return <<<HTML
            <input type="hidden" name="row_id" value="{$id}">
            <a href="{$href}/{$id}" class="btn-table-action btn-edit" data-id="{$id}">‚úèÔ∏è</a>
            <button type="button" class="btn-delete row-action" data-id="{$id}" href="{$hrefDel}/{$id}">üóëÔ∏è</button>
        HTML;
    }
}
